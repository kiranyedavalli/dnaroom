{"version":3,"sources":["people.js"],"names":["People","extend","namespace","children","batcher","get","person","reject","Error","_getMe","id","personId","request","list","options","Array","isArray","peopleIds","all","map","service","resource","qs","then","res","spark","inferPersonIdFromUuid","uuid","encode","body"],"mappings":";;;;;;;;;;;;;;yBAAA;;;;AAIA;;AACA;;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA;;;;;;;;AAQA;;;AAGA,IAAMA,SAAS,uBAAYC,MAAZ,SAAmB;AAChCC,qBADgC;;AAGhCC,YAAU;AACRC;AADQ,GAHsB;AAMhC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8BAC,KApCgC,eAoC5BC,MApC4B,EAoCpB;AACV,QAAI,CAACA,MAAL,EAAa;AACX,aAAO,kBAAQC,MAAR,CAAe,IAAIC,KAAJ,mCAAf,CAAP;AACD;AACD,QAAIF,eAAJ,EAAqB;AACnB,aAAO,KAAKG,MAAL,EAAP;AACD;AACD,QAAMC,KAAKJ,OAAOK,QAAP,IAAmBL,OAAOI,EAA1B,IAAgCJ,MAA3C;AACA,WAAO,KAAKF,OAAL,CAAaQ,OAAb,CAAqBF,EAArB,CAAP;AACD,GA7C+B;;;AA+ChC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6EAG,MA5HgC,gBA4H3BC,OA5H2B,EA4HlB;AAAA;;AACZ,QAAIC,MAAMC,OAAN,CAAcF,OAAd,CAAJ,EAA4B;AAC1B,UAAMG,YAAYH,OAAlB;AACA,aAAO,kBAAQI,GAAR,CACLD,UAAUE,GAAV,CAAc,UAACR,QAAD;AAAA,eAAc,MAAKP,OAAL,CAAaQ,OAAb,CAAqBD,QAArB,CAAd;AAAA,OAAd,CADK,CAAP;AAGD;AACD,WAAO,KAAKC,OAAL,CAAa;AAClBQ,sBADkB;AAElBC,wBAFkB;AAGlBC,UAAIR;AAHc,KAAb,EAKJS,IALI,CAKC,UAACC,GAAD;AAAA,aAAS,oBAASA,GAAT,EAAc,MAAKC,KAAnB,CAAT;AAAA,KALD,CAAP;AAMD,GAzI+B;;;AA2IhC;;;;;;AAMAC,uBAjJgC,iCAiJVC,IAjJU,EAiJJ;AAC1B,WAAO,eAAOC,MAAP,6BAAwCD,IAAxC,CAAP;AACD,GAnJ+B;AA6JhClB,QA7JgC,oBA6JvB;AACP,WAAO,KAAKgB,KAAL,CAAWb,OAAX,CAAmB;AACxBQ,sBADwB;AAExBC;AAFwB,KAAnB,EAIJE,IAJI,CAIC,UAACC,GAAD;AAAA,aAASA,IAAIK,IAAb;AAAA,KAJD,CAAP;AAKD,GAnK+B;AAAA;AAAA,CAAnB,yIAAf;;kBAsKe7B,M","file":"people.js","sourcesContent":["/*!\n * Copyright (c) 2015-2017 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport {SparkPlugin, Page} from '@ciscospark/spark-core';\nimport {base64, oneFlight} from '@ciscospark/common';\n\nimport PeopleBatcher from './people-batcher';\n\n/**\n * @typedef {Object} PersonObject\n * @property {string} id - (server generated) Unique identifier for the person\n * @property {Array<email>} emails - Email addresses of the person\n * @property {string} displayName - Display name of the person\n * @property {isoDate} created - (server generated) The date and time that the person was created\n */\n\n/**\n * @class\n */\nconst People = SparkPlugin.extend({\n  namespace: `People`,\n\n  children: {\n    batcher: PeopleBatcher\n  },\n  /**\n   * Returns a single person by ID\n   * @instance\n   * @memberof People\n   * @param {PersonObject|uuid|string} person\n   * @returns {Promise<PersonObject>}\n   * @example\n   * ciscospark.rooms.create({title: 'Get Person Example'})\n   *   .then(function(room) {\n   *     return ciscospark.memberships.create({\n   *       personEmail: 'alice@example.com',\n   *       roomId: room.id\n   *     });\n   *   })\n   *   .then(function(membership) {\n   *     return ciscospark.people.get(membership.personId);\n   *   })\n   *   .then(function(alice) {\n   *     var assert = require('assert');\n   *     assert(alice.id);\n   *     assert(Array.isArray(alice.emails));\n   *     assert.equal(alice.emails.filter(function(email) {\n   *       return email === 'alice@example.com';\n   *     }).length, 1);\n   *     assert(alice.displayName);\n   *     assert(alice.created);\n   *     return 'success';\n   *   });\n   *   // => success\n   */\n  get(person) {\n    if (!person) {\n      return Promise.reject(new Error(`A person with an id is required`));\n    }\n    if (person === `me`) {\n      return this._getMe();\n    }\n    const id = person.personId || person.id || person;\n    return this.batcher.request(id);\n  },\n\n  /**\n   * Returns a list of people\n   * @instance\n   * @memberof People\n   * @param {Object | uuid[]} options or array of uuids\n   * @param {email} options.email - Returns people with an email that contains this string\n   * @param {string} options.displayName - Returns people with a name that contains this string\n   * @returns {Promise<Page<PersonObject>>}\n   * @example\n   * var room;\n   * ciscospark.rooms.create({title: 'List People Example'})\n   *   .then(function(r) {\n   *     room = r;\n   *     return ciscospark.memberships.create({\n   *       personEmail: 'alice@example.com',\n   *       roomId: room.id\n   *     });\n   *   })\n   *   .then(function() {\n   *     return ciscospark.memberships.create({\n   *       personEmail: 'bob@example.com',\n   *       roomId: room.id\n   *     });\n   *   })\n   *   .then(function() {\n   *     return ciscospark.people.list({email: 'alice@example.com'});\n   *   })\n   *   .then(function(people) {\n   *     var assert = require('assert');\n   *     assert.equal(people.length, 1);\n   *     var person = people.items[0];\n   *     assert(person.id);\n   *     assert(Array.isArray(person.emails));\n   *     assert(person.displayName);\n   *     assert(person.created);\n   *     return 'success';\n   *   });\n   *   // => success\n   *  @example <caption>Example usage of array method</caption>\n   * var room;\n   * var aliceId;\n   * var bobId;\n   * ciscospark.rooms.create({title: 'List People Array Example'})\n   *   .then(function(r) {\n   *     room = r;\n   *     return ciscospark.memberships.create({\n   *       personEmail: 'alice@example.com',\n   *       roomId: room.id\n   *     });\n   *   })\n   *   .then(function(membership) {\n   *     aliceId = membership.personId;\n   *   })\n   *   .then(function() {\n   *     return ciscospark.memberships.create({\n   *       personEmail: 'bob@example.com',\n   *       roomId: room.id\n   *     });\n   *   })\n   *   .then(function(membership) {\n   *     bobId = membership.personId;\n   *   })\n   *   .then(function() {\n   *     return ciscospark.people.list([aliceId, bobId]);\n   *   })\n   *   .then(function(people) {\n   *     var assert = require('assert');\n   *     assert.equal(people.length, 2);\n   *     var person = people.items[0];\n   *     assert(person.id);\n   *     assert(Array.isArray(person.emails));\n   *     assert(person.displayName);\n   *     assert(person.created);\n   *     return 'success';\n   *   });\n   *   // => success\n   */\n  list(options) {\n    if (Array.isArray(options)) {\n      const peopleIds = options;\n      return Promise.all(\n        peopleIds.map((personId) => this.batcher.request(personId))\n      );\n    }\n    return this.request({\n      service: `hydra`,\n      resource: `people`,\n      qs: options\n    })\n      .then((res) => new Page(res, this.spark));\n  },\n\n  /**\n   * Converts a uuid to a hydra id without a network dip.\n   * @param {string} uuid\n   * @private\n   * @returns {string}\n   */\n  inferPersonIdFromUuid(uuid) {\n    return base64.encode(`ciscospark://us/PEOPLE/${uuid}`);\n  },\n\n  /**\n   * Fetches the current user from the /people/me endpoint\n   * @instance\n   * @memberof People\n   * @private\n   * @returns {Promise<PersonObject>}\n   */\n  @oneFlight\n  _getMe() {\n    return this.spark.request({\n      service: `hydra`,\n      resource: `people/me`\n    })\n      .then((res) => res.body);\n  }\n});\n\nexport default People;\n"]}